#!/bin/bash

export THIS_DIR=$PWD
export DEBIAN_FRONTEND=noninteractive

# ===== COLORS =====
GREEN="\e[32m"
CYAN="\e[36m"
YELLOW="\e[33m"
RED="\e[31m"
GRAY="\e[90m"
RESET="\e[0m"

clear

# ===== HEADER =====
echo -e "${CYAN}"
echo "========================================="
echo "     Minecraft Java Server Installer"
echo "========================================="
echo -e "${RESET}"

install_server () {
    choice=$1

    echo ""
    echo -e "${CYAN}> Preparing installation...${RESET}"
    sleep 1

    case "$choice" in
        1)
            echo -e "${GREEN}> Installing Vanilla Server${RESET}"
            bash <(curl -s https://raw.githubusercontent.com/hapis1703/minecraftserver/main/Java/vanilla)
            ;;
        2)
            echo -e "${GREEN}> Installing Paper Server${RESET}"
            bash <(curl -s https://raw.githubusercontent.com/hapis1703/minecraftserver/main/Java/paper)
            ;;
        3)
            echo -e "${GREEN}> Installing Fabric Server${RESET}"
            bash <(curl -s https://raw.githubusercontent.com/hapis1703/minecraftserver/main/Java/fabric)
            ;;
        4)
            echo -e "${GREEN}> Installing Folia Server${RESET}"
            bash <(curl -s https://raw.githubusercontent.com/hapis1703/minecraftserver/main/Java/folia)
            ;;
        5)
            echo -e "${GREEN}> Installing Forge Server${RESET}"
            bash <(curl -s https://raw.githubusercontent.com/hapis1703/minecraftserver/main/Java/forge)
            ;;
        6)
            echo -e "${GREEN}> Installing NeoForge Server${RESET}"
            bash <(curl -s https://raw.githubusercontent.com/hapis1703/minecraftserver/main/Java/neoforge)
            ;;
        7)
            echo -e "${GREEN}> Installing Pufferfish Server${RESET}"
            bash <(curl -s https://raw.githubusercontent.com/hapis1703/minecraftserver/main/Java/pufferfish)
            ;;
        8)
            echo -e "${GREEN}> Installing Purpur Server${RESET}"
            bash <(curl -s https://raw.githubusercontent.com/hapis1703/minecraftserver/main/Java/purpur)
            ;;
        9)
            echo -e "${GREEN}> Installing Quilt Server${RESET}"
            bash <(curl -s https://raw.githubusercontent.com/hapis1703/minecraftserver/main/Java/quilt)
            ;;
        *)
            echo -e "${RED}> Invalid selection. Restarting installer...${RESET}"
            sleep 1
            bash <(curl -s https://raw.githubusercontent.com/hapis1703/minecraftserver/main/installJava)
            exit 1
            ;;
    esac
}

# ===== DEPENDENCIES =====
echo -e "${CYAN}> Updating system & installing tools...${RESET}"
sudo apt update -qq
sudo apt install -y -qq screen neofetch

# ===== INFO =====
echo ""
echo -e "${YELLOW}IMPORTANT:${RESET} Using mcutils.com API"
echo -e "${GRAY}Available versions may be limited${RESET}"
echo ""

# ===== MENU =====
echo -e "${CYAN}Select Server Type:${RESET}"
echo ""
echo "  [1] Vanilla"
echo "  [2] Paper"
echo "  [3] Fabric"
echo "  [4] Folia"
echo "  [5] Forge"
echo "  [6] NeoForge"
echo "  [7] Pufferfish"
echo "  [8] Purpur"
echo "  [9] Quilt"
echo ""
read -rp "Enter choice [1-9]: " SERVER_TYPE

install_server "$SERVER_TYPE"

# ===== PLAYIT =====
echo ""
echo -e "${CYAN}> Installing Playit.gg...${RESET}"

cd ..

curl -SsL https://playit-cloud.github.io/ppa/key.gpg \
    | gpg --dearmor \
    | sudo tee /etc/apt/trusted.gpg.d/playit.gpg >/dev/null

echo "deb [signed-by=/etc/apt/trusted.gpg.d/playit.gpg] https://playit-cloud.github.io/ppa/data ./" \
    | sudo tee /etc/apt/sources.list.d/playit-cloud.list >/dev/null

sudo apt update -qq
sudo apt install -y -qq playit

# ===== DONE =====
echo ""
echo -e "${GREEN}âœ” Installation Completed Successfully!${RESET}"
echo -e "${CYAN}> Start your server with:${RESET} ./start"
echo ""
